<!DOCTYPE html/>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Bugs</title>
<link rel="stylesheet" type="text/css"
	href="https://cdn.rawgit.com/TeamFreeHugs/teamfreehugs.github.io/master/styles/styles.css"></link>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"
	type="text/javascript"></script>
<script
	src="http://cdnjs.cloudflare.com/ajax/libs/jquery-noty/2.2.2/packaged/jquery.noty.packaged.min.js"></script>
</head>
<body onload="getAuthToken()">

	<script type="text/javascript">
		function getCode() {
			console.log(window.location.hash);
			var url = window.location.hash;
			var hash = url.substring(url.indexOf("#") + 1);
			return hash;
		}

		function submit() {

			var username = document.getElementById('username');
			var password = document.getElementById('password');

			var title = document.getElementById('title');

			var text = document.getElementById('body');

			var obj = new Object();

			obj.title = title.value;

			obj.body = text.value;

			obj.assignee = "Eyeballcode";

			obj.milestone = 1;

			obj.state = "open";

			obj.labels = [ "bug" ];

			var JSONString = JSON.stringify(obj);

			var auth;

		}

		function getString(name) {
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"), results = regex
					.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1]
					.replace(/\+/g, " "));
		}

		function createCORSRequest(method, url) {
			var xhr = new XMLHttpRequest();
			if ("withCredentials" in xhr) {
				// Check if the XMLHttpRequest object has a "withCredentials" property.
				// "withCredentials" only exists on XMLHTTPRequest2 objects.
				xhr.open(method, url, true);
			} else if (typeof XDomainRequest != "undefined") {
				// Otherwise, check if XDomainRequest.
				// XDomainRequest only exists in IE, and is IE's way of making CORS requests.
				xhr = new XDomainRequest();
				xhr.open(method, url);
			} else {
				// Otherwise, CORS is not supported by the browser.
				xhr = null;
			}
			return xhr;
		}

		function getAuthToken() {
			noty({
				text : 'WARNING: THIS IS STILL IN DEV. DON\'T REPORT BUGS ABOUT THIS HERE.<br>Report them manually instead.'
			});
			if (getString("code") == "") {
				window.location = 'https://github.com/login/oauth/authorize?client_id=61ab3ede672413a14598&redirect_uri=http://teamfreehugs.github.io/bugs.html&scope=public_repo';
			} else if (getString("code") != "") {
				var code = getString("code").substring(4);
				//Please don't abuse!
				var decoded = atob('MGY3OGU4MjdiYjE4NjM4ZTY4Mzk5YWVkOGNkMGU0MjA2NWFjMjRiZg==');
				console.log(decoded);
				console.log(code);

				var url = 'https://github.com/login/oauth/access_token?client_id=61ab3ede672413a14598&client_secret='
						+ decoded
						+ '&code='
						+ code
						+ '&redirect_uri=http://teamfreehugs.github.io/bugs.html';
				var request = createCORSRequest('POST', url);
				if (!request) {
					noty({
						text : 'Sorry, we don\'t support your browser.'
					});
					console.log('ERROR');
					return;
				}

				console.log('Yay!');

				request.onload = function() {
					var responseText = request.responseText;
					console.log(responseText);
					console.log(request);
				}
				request.onerror = function() {
					console.log('There was an error!');
				}

				request.send()
			}
		}
	</script>
	<div class="round bottom shadow">
		<h2>Bugs</h2>
		<hr>
		<p>Hello! Did you find a bug in this site? Or do you want
			something to be added?</p>
		<p>
			If you want to add something, this is not the place for it. Click <a
				href="feature-req.html">here</a> instead!
		</p>


		<div id="report">
			<p>
				Bug title: <input id="title" type="text"></input>
			</p>
			<p>
				<textarea id="body" cols="" rows=""></textarea>
			</p>

			<hr>
			<p>
				Username: <input id="username"></input>
			</p>
			<p>
				Password: <input id="password"></input>
			</p>
			<button id="submit" onclick="submit()">Submit this bug!</button>
			<br>
		</div>
	</div>
</body>
</html>