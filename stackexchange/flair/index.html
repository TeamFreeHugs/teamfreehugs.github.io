<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flair Generator</title>
<link rel="stylesheet" type="text/css"
	href="http://teamfreehugs.github.io/styles/styles.css"></link>
<script src="http://teamfreehugs.github.io/js/URI.js"></script>
<script src="http://teamfreehugs.github.io/js/pnglib.js"></script>

<script>
	function getCode(name) {
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"), results = regex
				.exec(location.search);
		return results === null ? "" : decodeURIComponent(results[1].replace(
				/\+/g, " "));
	}

	function readTextFile(file) {
		var rawFile = new XMLHttpRequest();
		rawFile.open("GET", file, false);
		rawFile.onreadystatechange = function() {
			if (rawFile.readyState === 4) {
				if (rawFile.status === 200 || rawFile.status == 0) {
					return rawFile.responseText;
				}
			}
		}

		rawFile.onerror = function() {
			console.log(rawFile.status);
		}
		try {
			rawFile.send(null);
		} catch (e) {
			console.log('error');
			console.log(e);
		}
		return rawFile.responseText;
	}

	function imageExists(image_url) {

		var http = new XMLHttpRequest();

		http.open('HEAD', image_url, false);
		http.send();

		return http.status != 404;

	}

	function gen() {
		var image = new PNGlib(208, 58, 256);
		var background = image.color(238, 238, 238, 100);
		var url = document.getElementById('link');
		var out = document.getElementById('output');
		var link = url.value;
		var userID = "";
		var id = new URI(link).path.substring(7);
		for (var i = 0; i < id.split('').length; ++i) {
			var pos = id.split('')[i];
			if (isNaN(pos)) {
				break;
			}
			userID += pos;
		}
		var userInfoAPILink = 'https://api.stackexchange.com/2.2/users/'
				+ userID + '/associated?filter=!9YdnSFu)B&pagesize=100';
		console.log(userInfoAPILink);
		var response = JSON.parse(readTextFile(userInfoAPILink)).items[0];

		for (var pos = 0; pos < response.length; ++pos) {
			var site = response[pos];
			var badges = site.badge_counts;
			var gold = badges.gold;
			var silver = badges.silver;
			var bronze = badges.bronze;

			var isMod = site.user_type == "moderator";

			var profileImg = site.profile_image;

			var username = site.display_name;

			var rep = site.reputation;

			var link = site.link;

			var answer_count = site.answer_count;

			var question_count = site.question_count;
		}
		
		document.write('<img src="data:image/png;base64,'+image.getBase64()+'">');

	}
</script>
</head>
<body>
	<div class="round bottom shadow">
		<p id="back">
			<a href="..">Parent Directory</a>
		</p>
		<embed src=""></embed>
	</div>
</body>
</html>