<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inbox Reader</title>
<style>
.round {
	border-radius: 25px;
	background: #81F0CF;
	border: 2px solid #81F0CF;
	padding: 20px;
	width: 200px;
	height: 150px;
}

.bottom {
	z-index: -10000;
}
</style>
</head>
<body onload="prepareContent();">
	<div id="inboxItems" class="round bottom"
		style="width: 1000px; height: 400px; margin: 0 auto;">
		<p id="loadText">Loading, please wait for content to load...</p>
	</div>

	<script>
		function getCode() {
			console.log(window.location.hash);
			var url = window.location.hash;
			var hash = url.substring(url.indexOf("#") + 1);
			return hash;
		}

		function readTextFile(file) {
			var rawFile = new XMLHttpRequest();
			rawFile.open("GET", file, false);
			rawFile.onreadystatechange = function() {
				if (rawFile.readyState === 4) {
					if (rawFile.status === 200 || rawFile.status == 0) {
						return rawFile.responseText;
					}
				}
			}
			rawFile.send(null);
			return "";
		}

		function prepareContent() {
			var header = document.getElementById('loadText');
			header.innerHTML = "Javascript detected, loading...";
			var code = getCode().substring(13);
			if (code === "") {
				window.location = 'https://stackexchange.com/oauth/dialog?client_id=5176&scope=read_inbox,no_expiry&redirect_uri=http://teamfreehugs.github.io/stackexchange/inboxreader';
			} else {
				header.innerHTML = "Your code is: <pre>" + code
						+ "</pre> Please wait for me to load your inbox!";
				var inboxContentURL = 'https://api.stackexchange.com/2.2/inbox?access_token='
						+ code + "&key=Wb06jBCijTyKIkKf8YzuSg((";
				header.innerHTML = readTextFile((inboxContentURL);
				console.log(readTextFile(inboxContentURL));
			}
		}
	</script>
</body>
</html>